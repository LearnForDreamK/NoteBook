1、处理推荐重复内容的可选方案

- 为每个帖子保存一个布隆过滤器，记录阅览人的id。推荐时判断帖子对应的布隆过滤器中是否有该用户的推荐标记。

  **优点**：如果布隆过滤器大小设置足够合理，可以保证推荐系统推荐长时间内极其稳定，用户无论什么时候看到重复帖子的概率都会很低很低。

  **缺点：**布隆过滤器的大小难以设置，因为一个帖子的推荐用户数和用户查看数难以估算，无法准确设置布隆过滤器大小，布隆过滤器在数据量增大时，会增加误判概率。

  

- 每个用户独享一份布隆过滤器，定期更新布隆过滤器，重置推荐策略。

  **优点：**用户独享布隆过滤器，可以比较容易控制布隆过滤器的大小，因为用户的阅读量可以进行估算，一个用户按每天阅览300个帖子，一年可阅读11万个帖子，%5误判率
  ，5个绝对均匀的hash函数计算的情况下，需要一个98kb大小的布隆过滤器。

  **缺点：**考虑到用户量的问题，为每个用户分配的布隆过滤器的大小不能太大，用户的布隆过滤器需要定期重置更新，这就会带来一个问题，布隆过滤器重置的时候，如何保证推荐
  系统不推荐重复的内容给用户。 

  **一个解决方案（不知道是否可行）：**为每一个用户预留一个推荐间隙，任何用户在获取推荐帖子的时候，都无法看到**最近1天**的帖子，布隆过滤器更新的时候，就可以获取最近一天的
  推荐内容，保证有内容可以推荐给用户。推荐系统在推荐时，有以下步骤：
        1）首先进行帖子的时间判断，如果帖子发布时间比布隆过滤器更新的最新时间**早1天**以上，说明是以前的帖子，无法通过筛选。早一天以内可以通过这步筛选。
        2）如果帖子发布时间比布隆过滤器更新的时间晚，在 **[**昨天，今天**]** 时间段内的帖子无法进行推荐， **[**布隆过滤器更新日期，前天**]** 时间端内的帖子可以通过这步筛选。
        3）最后进行布隆过滤掉重复的帖子，返回帖子列表给用户。

  其他：如果上面每个用户的布隆过滤器可以够大，更新间期够长，则可以把间隙拉长一些， 又或者如果帖子内容足够丰富，可以把间隙拉短，减少用户首页推荐帖子的时间差。上面的
  方案的时间间隙是1天，用户看不到最近一天的帖子内容。 



考虑的内容

- 对于用户id的hash函数应该怎么样选取保证hash分布足够均匀。（现在只能考虑自带的hash函数通过抖动产生多个hash函数）

- 应该需要多少hash函数。误判率多少合适，%5感觉已经足够。

- 布隆过滤器过滤周期的选择，以多少时间为一个周期。

- 布隆过滤器更新时，如何保证推荐不重复。（上述的方案比较折中）。

- 用户量较少的情况下，可以把布隆过滤器大小调大，然后中转周期可以拉长，预留更多的时间给更新布隆过滤器时推荐的帖子选择。

  

带@标记表示当天布隆过滤器更新
1 2 3 @4 5 6 7 8 9 @10 11 12 @13 14 15
布隆过滤器A
4 ：3
5 ：3 4
6： 3 4 5
7： 3 4 5 6
8： 3 4 5 6 7
9： 3 4 5 6 7 8
布隆过滤器B
10：9
11：9 10 
12：9 10 11
13号用户提早更新了布隆过滤器
布隆过滤器C
13：12
14：12 13
15：12 13 14